
{% load static %}
{% include 'reservations/modal_detail.html' %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" type="" href="{% static 'CssStyle/style_home.css' %}">
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss/dist/tailwind.min.css" rel="stylesheet">
</head>

<style>
    .card-body{
        margin-bottom: 20px;
        margin-top: 20px;

        box-shadow: 0 0 5px 1px rgba(0, 0 , 0, 0.5);
    }

</style>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>


<script>
    $(document).ready(function() {
        $('#staticBackdrop').on('show.bs.modal', function (event) {
            var link = $(event.relatedTarget); // Button that triggered the modal
            var ids = link.data('id').split('-');
            var trajetId = ids[0];
            var segmentId = ids[1];
            // var trajetId = link.data('id'); // Extract info from data-* attributes
            var modal = $(this);
            console.log(trajetId)

            $.ajax({
                // url: '/TravelTickets_Detail_trajet/' + trajetId + '/' + segmentId + '/',
                url: '/TravelTickets_Detail_trajet/' + (trajetId ? trajetId : '0') + '/' + (segmentId ? segmentId : '0') + '/', // URL de la vue Django avec les ID du trajet et du segment

                method: 'GET',
                success: function(data) {
                    var trajet = data.trajet; // Récupère les détails du trajet depuis la réponse JSON
                    var avantages = trajet.avantages; // Liste des avantages
                //     var avantagesHtml = '<ul>';

                // // Utilisation d'une boucle `for` pour itérer sur les avantages
                //     for (var i = 0; i < avantages.length; i++) {
                //         avantagesHtml += '<li>' + avantages[i].nom + ': ' + avantages[i].description + '</li>';
                //         console.log(avantages[i].nom)
                //     }
                //     avantagesHtml += '</ul>';
                    modal.find('#staticBackdropLabel').text('Détails du Segment'); // You can set a dynamic title here
                    modal.find('.modal-body').html(`
                        <p><strong>Départ :</strong> ${trajet.id}</p>
                        <p><strong>Arrivée :</strong> ${trajet.arrivee}</p>
                        <p><strong>Segment ID :</strong> ${trajet.id}</p>
                        <p><strong>Type de Car :</strong> ${trajet.depart}</p>
                        <p><strong>Trajet ID :</strong> ${trajet.id_segment}</p>
                        <p><strong>Avantages :</strong> ${trajet.car}</p>
                        <p><strong>Avantages :</strong> ${trajet.type}</p>
                        <p><strong>Avantages :</strong> ${trajet.prix}</p>



                    `);
                },
                error: function() {
                    alert('Impossible de charger les détails du segment.');
                }
            });
        });
    });
</script>



<body>
    <!-- <li class="list-group-item"> {{ trajet.adress_depart }} - {{ segment.arrivee }} -  {{ trajet.id }}   -- Prix: 343433434  FCFA   {{ trajet.car.type }}  --  {{ trajet.id }} </li>  -->

    <div class="container">
        <h1>Rechercher un Trajet</h1>
        <div class="container">
          <h1 class="mt-5">Rechercher un trajet</h1>
          <form method="post" class="mt-3">
              {% csrf_token %}
              {{ form.as_p }}
              <button type="submit" class="btn btn-primary">Rechercher</button>
          </form>
      </div>
    </div>


    <div class="container">
        <h1>Trajet Disponible </h1>
        
        {% if segments_disponibles %}
  
            {% for trajet, segment, horairesegments ,trajet_segment in segments_disponibles %}

                {% for horaire in horairesegments %}

                    <div class="card-body">
                        <ul class="list-group">
                    
                            
                            <a href="{% url 'detail_trajet' trajet.id segment.id %}"  class="btn "  data-id="{{ trajet.id }}-{{ segment.id }}" data-bs-toggle="modal" data-bs-target="#staticBackdrop">
                                <li class="list-group-item"> {{ horaire.heure_depart|time:"H\hi" }}  </li>
                                <li class="list-group-item"> {{ segment.depart }} - {{ segment.arrivee }} -  {{ segment.id }}   -- Prix: {{ trajet_segment.prix_segment }}  FCFA   {{ trajet.car.type }}  --  {{ trajet.id }} </li>
                            </a>
                            <a  href="" class="btn btn-outline-warning">Continuer</a>

                    
                    
                        </ul>
                    </div>
                {% endfor %}

        {% endfor %}

        {% else %}
            <p>Aucun trajet trouvé pour ces critères.</p>
        {% endif %}
    </div>
    <!-- Modal -->
<div class="modal fade" id="staticBackdrop" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-scrollable">
    <div class="modal-content">
        <div class="modal-header">
        <h5 class="modal-title" id="staticBackdropLabel"></h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
            
        </div>
        <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        <button type="button" class="btn btn-primary">Understood</button>
        </div>
    </div>
    </div>
</div>



 
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>


    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>

</body>
</html>